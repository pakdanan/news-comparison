<!DOCTYPE html>
<html lang="id" x-data="newsApp()" class="bg-gray-100">
<head>
  <meta charset="UTF-8">
  <title>Perbandingan Berita Indonesia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="min-h-screen p-4">
  <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-md p-6" x-cloak>
    <h1 class="text-2xl font-bold text-center text-blue-700 mb-4">ğŸ“° Portal Berita Indonesia</h1>

    <!-- API Key Input -->
    <div class="mb-4">
      <label class="block mb-1 font-medium text-sm text-gray-700">ğŸ”‘ Masukkan API Key NewsData.io</label>
      <input type="text" x-model="apiKey"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-blue-400"
             placeholder="Contoh: pub_123456...">
    </div>

    <!-- Mode Switch Tabs -->
    <div class="flex justify-center gap-4 mb-6">
      <button @click="mode = 'basic'"
              :class="mode === 'basic' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'"
              class="px-4 py-2 rounded-lg transition">ğŸ” Pencarian Biasa</button>
      <button @click="mode = 'compare'"
              :class="mode === 'compare' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'"
              class="px-4 py-2 rounded-lg transition">ğŸ“° Perbandingan Berita</button>
    </div>

    <!-- Keyword Input -->
    <div class="flex gap-2 mb-4">
      <input type="text" x-model="keyword" @keydown.enter="search"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-blue-400"
             placeholder="Masukkan topik, contoh: pemilu, ekonomi, teknologi">
      <button @click="search"
              :disabled="!apiKey || !keyword"
              class="px-4 py-2 rounded-lg transition text-white"
              :class="(!apiKey || !keyword) ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'">
        Cari
      </button>
    </div>

    <!-- Loading -->
    <template x-if="loading">
      <p class="text-gray-500 text-sm mb-4">ğŸ”„ Mengambil berita...</p>
    </template>

    <!-- MODE: BASIC -->
    <div x-show="mode === 'basic' && !loading && basicResults.length > 0" class="grid sm:grid-cols-2 md:grid-cols-3 gap-4">
      <template x-for="item in basicResults" :key="item.link">
        <div class="bg-gray-50 rounded-lg shadow p-4 flex flex-col">
          <h2 class="font-semibold text-sm mb-1" x-text="item.title"></h2>
          <p class="text-xs text-gray-700 mb-2" x-text="item.description"></p>
          <a :href="item.link" target="_blank" class="text-blue-600 text-sm hover:underline mt-auto">Baca Selengkapnya</a>
        </div>
      </template>
    </div>

    <!-- MODE: COMPARE -->
    <div x-show="mode === 'compare' && !loading && Object.keys(groupedResults).length > 0" class="space-y-6">
      <template x-for="[source, items] in Object.entries(groupedResults)" :key="source">
        <div>
          <!-- Logo + Source Name -->
          <div class="flex items-center justify-center gap-2 mb-2">
            <template x-if="items[0]?.source_icon">
              <img :src="items[0].source_icon" alt="Logo" class="w-6 h-6 rounded">
            </template>
            <h3 class="text-lg font-semibold text-blue-600" x-text="source"></h3>
          </div>

          <!-- List Berita -->
          <div class="grid md:grid-cols-2 gap-3">
            <template x-for="item in items" :key="item.link">
              <div class="bg-gray-50 p-3 rounded shadow">
                <h4 class="font-semibold text-sm mb-1" x-text="item.title"></h4>
                <p class="text-xs text-gray-700 mb-2" x-text="item.description"></p>
                <a :href="item.link" target="_blank" class="text-blue-500 text-sm hover:underline">Baca Selengkapnya</a>
              </div>
            </template>
          </div>
        </div>
      </template>
    </div>

    <!-- No Result -->
    <template x-if="!loading && keyword && !hasAnyResult">
      <p class="text-gray-500 mt-4 text-center">ğŸ˜• Tidak ada hasil ditemukan untuk "<span x-text="keyword"></span>"</p>
    </template>
  </div>

  <!-- Alpine Component -->
  <script>
    function newsApp() {
      return {
        mode: 'basic',
        keyword: '',
        apiKey: '',
        loading: false,
        basicResults: [],
        groupedResults: {},

        async search() {
          if (!this.keyword.trim() || !this.apiKey.trim()) return;

          this.loading = true;
          this.basicResults = [];
          this.groupedResults = {};

          const baseURL = `https://newsdata.io/api/1/news?apikey=${this.apiKey}&q=${encodeURIComponent(this.keyword)}&country=id&language=id`;

          try {
            const res = await fetch(baseURL);
            const data = await res.json();

            if (this.mode === 'basic') {
              this.basicResults = data.results || [];
            } else if (this.mode === 'compare') {
              const grouped = {};
              (data.results || []).forEach(item => {
                const source = item.source_id || "Tidak diketahui";
                if (!grouped[source]) grouped[source] = [];
                grouped[source].push(item);
              });
              this.groupedResults = grouped;
            }
          } catch (e) {
            console.error("Gagal mengambil data berita:", e);
          } finally {
            this.loading = false;
          }
        },

        get hasAnyResult() {
          return this.basicResults.length > 0 || Object.keys(this.groupedResults).length > 0;
        }
      }
    }
  </script>
</body>
</html>
